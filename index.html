<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rifa Franklin Monsalve - $1.000.000</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, sans-serif;
        }
        .number-grid {
            grid-template-columns: repeat(5, 1fr);
        }
        @media (min-width: 640px) {
            .number-grid {
                grid-template-columns: repeat(10, 1fr);
            }
        }
        .number-button {
            min-height: 44px;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .pulse-glow {
            animation: pulseGlow 2s infinite;
        }
        @keyframes pulseGlow {
            0% { box-shadow: 0 0 5px rgba(59, 130, 246, 0.5); }
            50% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.8); }
            100% { box-shadow: 0 0 5px rgba(59, 130, 246, 0.5); }
        }
        .file-input {
            display: none;
        }
        .file-label {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .file-label:hover {
            transform: scale(1.05);
        }
        .responsive-grid {
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
        }
        .responsive-button {
            min-width: 60px;
            min-height: 60px;
            font-size: 0.875rem;
        }
        @media (max-width: 380px) {
            .responsive-button {
                min-width: 50px;
                min-height: 50px;
                font-size: 0.75rem;
            }
        }
        .form-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        @media (min-width: 640px) {
            .form-buttons {
                flex-direction: row;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-900 via-purple-800 to-indigo-900 min-h-screen">
    <div id="app"></div>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- CONFIGURACIÃ“N FIREBASE -->
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAGC_fsHfnguY4m0o2OE3SLSanDGk39zbM",
            authDomain: "rifa-franklin.firebaseapp.com",
            projectId: "rifa-franklin",
            storageBucket: "rifa-franklin.firebasestorage.app",
            messagingSenderId: "451592144799",
            appId: "1:451592144799:web:7ea7a0e85a6579f8b69faa",
            measurementId: "G-Q4XVNYKVWB"
        };
        firebase.initializeApp(firebaseConfig);
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { jsPDF } = window.jspdf;

        function TalonarioRifa() {
            const [selectedNumbers, setSelectedNumbers] = useState(new Set());
            const [soldNumbers, setSoldNumbers] = useState(new Set());
            const [showTicket, setShowTicket] = useState(false);
            const [currentTicket, setCurrentTicket] = useState(null);
            const [showForm, setShowForm] = useState(false);
            const [formData, setFormData] = useState({
                nombre: '',
                apellido: '',
                telefono: '',
                email: '',
                metodoPago: 'nequi'
            });
            const [ticketData, setTicketData] = useState({});
            const [pendingNumbers, setPendingNumbers] = useState(new Set());
            const [showAdminPanel, setShowAdminPanel] = useState(false);
            const [adminPassword, setAdminPassword] = useState('');
            const [isAdmin, setIsAdmin] = useState(false);
            const [lastSale, setLastSale] = useState(null);
            const [syncStatus, setSyncStatus] = useState('ðŸŸ¡ Conectando...');
            const [reservedNumbers, setReservedNumbers] = useState(new Set());
            const [showDrawPanel, setShowDrawPanel] = useState(false);
            const [winnerNumber, setWinnerNumber] = useState(null);
            const [drawExecuted, setDrawExecuted] = useState(false);
            const [ticketCounter, setTicketCounter] = useState(1);
            const [isUploading, setIsUploading] = useState(false);
            const [showUpdatePaymentModal, setShowUpdatePaymentModal] = useState(false);
            const [selectedReservedNumber, setSelectedReservedNumber] = useState(null);
            const [updatePaymentData, setUpdatePaymentData] = useState({
                metodoPago: 'nequi'
            });
            const [paymentConfirmed, setPaymentConfirmed] = useState(false);
            const [showClearDataModal, setShowClearDataModal] = useState(false);
            const [clearDataConfirmation, setClearDataConfirmation] = useState('');

            const ADMIN_PASSWORD = "Franklin2024";
            const db = firebase.firestore();
            const storage = firebase.storage();

            // Cargar datos iniciales y configurar Firebase
            useEffect(() => {
                loadLocalData();
                setupFirebaseListeners();
            }, []);

            const loadLocalData = () => {
                const savedSoldNumbers = localStorage.getItem('rifaSoldNumbers');
                const savedTicketData = localStorage.getItem('rifaTicketData');
                const savedAdmin = localStorage.getItem('rifaAdmin');
                
                if (savedSoldNumbers) setSoldNumbers(new Set(JSON.parse(savedSoldNumbers)));
                if (savedTicketData) setTicketData(JSON.parse(savedTicketData));
                if (savedAdmin) setIsAdmin(JSON.parse(savedAdmin));
            };

            const setupFirebaseListeners = () => {
                // Escuchar nÃºmeros vendidos
                db.collection('rifa').doc('numbers')
                    .onSnapshot((doc) => {
                        const data = doc.data() || {};
                        const soldSet = new Set(Object.keys(data).map(Number));
                        setSoldNumbers(soldSet);
                        setSyncStatus('ðŸŸ¢ CONECTADO - Tiempo Real');
                    }, (error) => {
                        setSyncStatus('ðŸ”´ Error: ' + error.message);
                    });

                // Escuchar tickets
                db.collection('rifa').doc('tickets')
                    .onSnapshot((doc) => {
                        const data = doc.data() || {};
                        setTicketData(data);
                    });

                // Escuchar nÃºmeros reservados
                db.collection('rifa').doc('reserved')
                    .onSnapshot((doc) => {
                        const data = doc.data() || {};
                        setReservedNumbers(new Set(Object.keys(data).map(Number)));
                    });

                // Escuchar informaciÃ³n del sorteo
                db.collection('rifa').doc('draw')
                    .onSnapshot((doc) => {
                        const data = doc.data() || {};
                        if (data.winner !== undefined) {
                            setWinnerNumber(data.winner);
                            setDrawExecuted(true);
                        }
                    });

                // Escuchar contador de tickets
                db.collection('rifa').doc('metadata')
                    .onSnapshot((doc) => {
                        const data = doc.data() || {};
                        if (data.ticketCounter !== undefined) {
                            setTicketCounter(data.ticketCounter);
                        }
                    });
            };

            // NUEVA FUNCIÃ“N: Abrir modal para actualizar pago de reserva
            const openUpdatePaymentModal = (num) => {
                setSelectedReservedNumber(num);
                setUpdatePaymentData({
                    metodoPago: 'nequi'
                });
                setShowUpdatePaymentModal(true);
            };

            // NUEVA FUNCIÃ“N: Actualizar reserva a pagado
            const updateReservationToPaid = async (e) => {
                e.preventDefault();
                
                setIsUploading(true);
                const ticketInfo = ticketData[selectedReservedNumber];

                try {
                    // Actualizar informaciÃ³n del ticket
                    const updatedTicketInfo = {
                        ...ticketInfo,
                        estado: 'pagado',
                        metodoPago: updatePaymentData.metodoPago,
                        fechaPago: new Date().toLocaleString('es-CO'),
                        timestampPago: new Date().getTime()
                    };

                    // Actualizar estado local
                    const newTicketData = { ...ticketData, [selectedReservedNumber]: updatedTicketInfo };
                    const newSold = new Set([...soldNumbers, selectedReservedNumber]);
                    const newReserved = new Set(reservedNumbers);
                    newReserved.delete(selectedReservedNumber);

                    setTicketData(newTicketData);
                    setSoldNumbers(newSold);
                    setReservedNumbers(newReserved);
                    setShowUpdatePaymentModal(false);

                    // Guardar en localStorage
                    localStorage.setItem('rifaSoldNumbers', JSON.stringify([...newSold]));
                    localStorage.setItem('rifaTicketData', JSON.stringify(newTicketData));

                    // Guardar en Firebase
                    await db.collection('rifa').doc('numbers').set({ [selectedReservedNumber]: true }, { merge: true });
                    await db.collection('rifa').doc('tickets').set({ [selectedReservedNumber]: updatedTicketInfo }, { merge: true });
                    await db.collection('rifa').doc('reserved').update({ [selectedReservedNumber]: firebase.firestore.FieldValue.delete() });

                    // NotificaciÃ³n de actualizaciÃ³n
                    setLastSale({
                        numero: selectedReservedNumber,
                        cliente: ticketInfo.nombre + (ticketInfo.apellido ? ' ' + ticketInfo.apellido : ''),
                        telefono: ticketInfo.telefono,
                        metodoPago: updatePaymentData.metodoPago,
                        timestamp: new Date().getTime(),
                        tipo: 'actualizaciÃ³n'
                    });

                    // Enviar confirmaciÃ³n al cliente
                    const confirmationMessage = `ðŸŽŸï¸ *ACTUALIZACIÃ“N DE PAGO - RIFA $1.000.000* ðŸŽŸï¸\n\n` +
                        `Â¡Hola ${ticketInfo.nombre}! Tu pago ha sido confirmado.\n\n` +
                        `ðŸ‘¤ *Titular:* ${ticketInfo.nombre} ${ticketInfo.apellido || ''}\n` +
                        `ðŸŽ¯ *Tu NÃºmero:* ${selectedReservedNumber.toString().padStart(3, '0')}\n` +
                        `ðŸŽ« *Ticket No:* ${ticketInfo.ticketNumber}\n` +
                        `ðŸ“‹ *Estado:* âœ… PAGADO\n\n` +
                        `Â¡Mucha suerte! ðŸ€`;

                    window.open(`https://wa.me/57${ticketInfo.telefono}?text=${encodeURIComponent(confirmationMessage)}`, '_blank');

                    alert('âœ… Pago confirmado exitosamente. El nÃºmero ha sido actualizado a PAGADO.');

                } catch (error) {
                    console.error('Error actualizando el pago:', error);
                    alert('âŒ Error al procesar el pago. IntÃ©ntalo de nuevo.');
                } finally {
                    setIsUploading(false);
                }
            };

            const toggleNumber = (num) => {
                if (soldNumbers.has(num) || reservedNumbers.has(num)) {
                    alert(`âŒ El nÃºmero ${num.toString().padStart(3, '0')} ya estÃ¡ ocupado`);
                    return;
                }
                
                const newSelected = new Set(selectedNumbers);
                if (newSelected.has(num)) {
                    newSelected.delete(num);
                } else {
                    if (newSelected.size >= 5) {
                        alert('âŒ MÃ¡ximo 5 nÃºmeros por persona');
                        return;
                    }
                    newSelected.add(num);
                }
                setSelectedNumbers(newSelected);
            };

            const openForm = () => {
                if (selectedNumbers.size === 0) {
                    alert('âŒ Por favor selecciona al menos un nÃºmero');
                    return;
                }
                setShowForm(true);
                setPendingNumbers(new Set([...pendingNumbers, ...selectedNumbers]));
                setFormData({
                    nombre: '',
                    apellido: '',
                    telefono: '',
                    email: '',
                    metodoPago: 'nequi'
                });
                setPaymentConfirmed(false);
            };

            const handleFormChange = (e) => {
                setFormData({
                    ...formData,
                    [e.target.name]: e.target.value
                });
            };

            const handleUpdatePaymentChange = (e) => {
                setUpdatePaymentData({
                    ...updatePaymentData,
                    [e.target.name]: e.target.value
                });
            };

            const abrirNequi = () => {
                const appUrl = "nequi://pago?telefono=3197118858&monto=25000";
                const fallbackUrl = "https://api.whatsapp.com/send?phone=573197118858&text=Hola%20Franklin,%20quiero%20pagar%20mi%20boleta%20de%20rifa%20por%20Nequi";
                
                window.location.href = appUrl;
                setTimeout(() => {
                    window.open(fallbackUrl, '_blank');
                }, 500);
            };

            const generarTicketWhatsApp = (numeros, userData, estado) => {
                const nombreCompleto = `${userData.nombre} ${userData.apellido || ''}`.trim();
                const estadoTexto = estado === 'pagado' ? 'PAGADO' : 'RESERVADO';
                const numerosTexto = Array.from(numeros).map(num => num.toString().padStart(3, '0')).join(', ');
                
                const message = `ðŸŽŸï¸ *TICKET OFICIAL - RIFA $1.000.000* ðŸŽŸï¸\n\n` +
                    `ðŸ‘¤ *Cliente:* ${nombreCompleto}\n` +
                    `ðŸ“± *TelÃ©fono:* ${userData.telefono}\n` +
                    `ðŸ“§ *Email:* ${userData.email || 'No proporcionado'}\n\n` +
                    `ðŸŽ¯ *NÃºmeros Asignados:* ${numerosTexto}\n` +
                    `ðŸŽ« *Ticket No:* ${userData.ticketNumber}\n` +
                    `ðŸ“‹ *Estado:* ${estadoTexto}\n\n` +
                    `ðŸ’° *Premio:* $1.000.000 COP\n` +
                    `ðŸ’µ *Valor Total:* ${25000 * numeros.size} COP\n` +
                    `ðŸŽ² *Sorteo:* Chance Pick 3 Noche\n` +
                    `ðŸ“… *Fecha Sorteo:* 31 de Octubre\n\n` +
                    `ðŸ† *Organiza:* Franklin Monsalve\n` +
                    `ðŸ“ž *Contacto:* +57 3197118858\n\n` +
                    `âœ… *TICKET REGISTRADO OFICIALMENTE*\n` +
                    `Â¡Mucha suerte! ðŸ€`;

                return message;
            };

            const submitForm = async (e) => {
                e.preventDefault();
                if (!formData.nombre || !formData.telefono) {
                    alert('Por favor completa al menos el nombre y telÃ©fono');
                    return;
                }

                setIsUploading(true);
                const ticketNumber = `TK-${ticketCounter.toString().padStart(5, '0')}`;

                try {
                    const ticketInfo = {
                        ...formData,
                        fecha: new Date().toLocaleString('es-CO'),
                        numeros: Array.from(selectedNumbers),
                        estado: 'pagado',
                        ticketNumber,
                        timestamp: new Date().getTime()
                    };

                    const newTicketData = { ...ticketData };
                    const newSold = new Set([...soldNumbers, ...selectedNumbers]);
                    const newReserved = new Set(reservedNumbers);
                    
                    selectedNumbers.forEach(num => {
                        newTicketData[num] = ticketInfo;
                        newReserved.delete(num);
                    });

                    setTicketData(newTicketData);
                    setSoldNumbers(newSold);
                    setReservedNumbers(newReserved);
                    setSelectedNumbers(new Set());
                    setPendingNumbers(new Set());
                    setShowForm(false);
                    setPaymentConfirmed(true);

                    localStorage.setItem('rifaSoldNumbers', JSON.stringify([...newSold]));
                    localStorage.setItem('rifaTicketData', JSON.stringify(newTicketData));

                    const numbersObj = {};
                    newSold.forEach(num => { numbersObj[num] = true; });
                    
                    await db.collection('rifa').doc('numbers').set(numbersObj);
                    await db.collection('rifa').doc('tickets').set(newTicketData);
                    
                    const reservedUpdate = {};
                    selectedNumbers.forEach(num => {
                        reservedUpdate[num] = firebase.firestore.FieldValue.delete();
                    });
                    await db.collection('rifa').doc('reserved').update(reservedUpdate);
                    
                    await db.collection('rifa').doc('metadata').set({ ticketCounter: ticketCounter + 1 }, { merge: true });

                    setTicketCounter(ticketCounter + 1);

                    setLastSale({
                        numeros: Array.from(selectedNumbers),
                        cliente: formData.nombre + (formData.apellido ? ' ' + formData.apellido : ''),
                        telefono: formData.telefono,
                        metodoPago: formData.metodoPago,
                        timestamp: new Date().getTime()
                    });

                    const ticketMessage = generarTicketWhatsApp(selectedNumbers, ticketInfo, 'pagado');
                    window.open(`https://wa.me/57${formData.telefono}?text=${encodeURIComponent(ticketMessage)}`, '_blank');

                    sendToFranklinWhatsApp(selectedNumbers, ticketInfo, 'pagado');

                    setCurrentTicket(Array.from(selectedNumbers)[0]);
                    setShowTicket(true);

                } catch (error) {
                    console.error('Error guardando en Firebase:', error);
                    alert('âŒ Error al procesar el pago. IntÃ©ntalo de nuevo.');
                } finally {
                    setIsUploading(false);
                }
            };

            const reserveNumber = async (e) => {
                e.preventDefault();
                if (!formData.nombre || !formData.telefono) {
                    alert('Por favor completa al menos el nombre y telÃ©fono');
                    return;
                }

                const ticketNumber = `TK-${ticketCounter.toString().padStart(5, '0')}`;
                const ticketInfo = {
                    ...formData,
                    fecha: new Date().toLocaleString('es-CO'),
                    numeros: Array.from(selectedNumbers),
                    estado: 'reservado',
                    ticketNumber,
                    timestamp: new Date().getTime()
                };

                const newTicketData = { ...ticketData };
                const newReserved = new Set([...reservedNumbers, ...selectedNumbers]);

                selectedNumbers.forEach(num => {
                    newTicketData[num] = ticketInfo;
                });

                setTicketData(newTicketData);
                setReservedNumbers(newReserved);
                setSelectedNumbers(new Set());
                setPendingNumbers(new Set());
                setShowForm(false);
                setPaymentConfirmed(true);

                const reservedObj = {};
                selectedNumbers.forEach(num => { reservedObj[num] = true; });
                
                await db.collection('rifa').doc('reserved').set(reservedObj, { merge: true });
                await db.collection('rifa').doc('tickets').set(newTicketData);
                await db.collection('rifa').doc('metadata').set({ ticketCounter: ticketCounter + 1 }, { merge: true });

                setTicketCounter(ticketCounter + 1);
                
                procesarAccionCliente(selectedNumbers, ticketInfo, 'reservado');
            };

            const procesarAccionCliente = (numeros, userData, estado) => {
                sendToFranklinWhatsApp(numeros, userData, estado);
                sendConfirmationWhatsApp(numeros, userData, estado);
                setCurrentTicket(Array.from(numeros)[0]);
                setShowTicket(true);
            };

            const sendConfirmationWhatsApp = (numeros, userData, estado) => {
                const nombreCompleto = `${userData.nombre} ${userData.apellido || ''}`;
                const estadoTexto = estado === 'pagado' ? 'PAGADO' : 'RESERVADO';
                const numerosTexto = Array.from(numeros).map(num => num.toString().padStart(3, '0')).join(', ');
                
                const message = `ðŸŽŸï¸ *CONFIRMACIÃ“N DE BOLETA - RIFA $1.000.000* ðŸŽŸï¸\n\n` +
                    `Â¡Hola ${nombreCompleto}! Tu boleta ha sido registrada con Ã©xito.\n\n` +
                    `ðŸ‘¤ *Titular:* ${nombreCompleto}\n` +
                    `ðŸŽ¯ *Tus NÃºmeros:* ${numerosTexto}\n` +
                    `ðŸŽ« *Ticket No:* ${userData.ticketNumber}\n` +
                    `ðŸ“‹ *Estado:* ${estadoTexto}\n\n` +
                    (estado === 'reservado' ? `âš ï¸ *IMPORTANTE:* Recuerda realizar el pago antes de la fecha del sorteo para participar. NÃºmero que no se paga no juega.\n\n` : '') +
                    `Â¡Mucha suerte! ðŸ€`;
                window.open(`https://wa.me/57${userData.telefono}?text=${encodeURIComponent(message)}`, '_blank');
            };

            const sendToFranklinWhatsApp = (numeros, userData, estado) => {
                const nombreCompleto = `${userData.nombre} ${userData.apellido || ''}`;
                const metodoPagoText = {
                    'nequi': 'ðŸ“± Nequi', 
                    'efectivo': 'ðŸ’µ Efectivo', 
                    'transferencia': 'ðŸ“² Transferencia',
                    'bancolombia': 'ðŸ¦ Bancolombia'
                }[userData.metodoPago];

                const numerosTexto = Array.from(numeros).map(num => num.toString().padStart(3, '0')).join(', ');

                const message = `ðŸŽŸï¸ *NUEVA ${estado.toUpperCase()} DE RIFA* ðŸŽŸï¸\n\n` +
                    `ðŸ‘¤ *Cliente:* ${nombreCompleto}\n` +
                    `ðŸ“± *TelÃ©fono:* ${userData.telefono}\n` +
                    `ðŸ“§ *Email:* ${userData.email || 'No proporcionado'}\n` +
                    `ðŸ’° *MÃ©todo de Pago:* ${metodoPagoText}\n` +
                    `ðŸ•’ *Fecha:* ${new Date().toLocaleString('es-CO')}\n\n` +
                    `ðŸŽ¯ *NÃºmeros Vendidos:* ${numerosTexto}\n` +
                    `ðŸŽ« *Ticket No:* ${userData.ticketNumber}\n` +
                    `ðŸ’° *Premio:* $1.000.000 COP\n` +
                    `ðŸ’µ *Valor Total:* ${25000 * numeros.size} COP\n\n` +
                    `${estado === 'pagado' ? 'âœ… VENTA CONFIRMADA' : 'ðŸ“… RESERVA CONFIRMADA'}`;

                window.open(`https://wa.me/573197118858?text=${encodeURIComponent(message)}`, '_blank');
            };

            const cancelForm = () => {
                setShowForm(false);
                setPendingNumbers(new Set([...pendingNumbers].filter(n => !selectedNumbers.has(n))));
            };

            const showClientTicket = () => {
                setShowTicket(true);
            };

            const shareClientTicket = () => {
                if (!currentTicket) return;
                
                const userInfo = ticketData[currentTicket] || {};
                const nombreCompleto = userInfo.nombre + (userInfo.apellido ? ' ' + userInfo.apellido : '') || 'Cliente';
                const numeros = userInfo.numeros || [currentTicket];
                const numerosTexto = numeros.map(num => num.toString().padStart(3, '0')).join(', ');
                
                const message = `ðŸŽŸï¸ *BOLETA OFICIAL - RIFA $1.000.000* ðŸŽŸï¸\n\n` +
                    `ðŸ‘¤ *Titular:* ${nombreCompleto}\n` +
                    `ðŸ“± *TelÃ©fono:* ${userInfo.telefono || 'Registrado'}\n\n` +
                    `ðŸŽ¯ *Mis NÃºmeros:* ${numerosTexto}\n` +
                    `ðŸ’° *Premio:* $1.000.000 COP\n` +
                    `ðŸ’µ *Valor:* ${25000 * numeros.length} COP\n` +
                    `ðŸŽ² *Sorteo:* Chance Pick 3 Noche\n` +
                    `ðŸ“… *Fecha:* 31 de Octubre\n\n` +
                    `ðŸ† *Organiza:* Franklin Monsalve\n` +
                    `ðŸ“ž *Contacto:* +57 3197118858\n\n` +
                    `âœ… *BOLETA REGISTRADA OFICIALMENTE*\n` +
                    `Â¡Mucha suerte! ðŸ€`;
                window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
            };

            const openAdminPanel = () => {
                setShowAdminPanel(true);
                setAdminPassword('');
            };

            const handleAdminLogin = (e) => {
                e.preventDefault();
                if (adminPassword === ADMIN_PASSWORD) {
                    setIsAdmin(true);
                    setShowAdminPanel(false);
                    localStorage.setItem('rifaAdmin', 'true');
                    alert('âœ… Acceso de administrador concedido');
                } else {
                    alert('âŒ ContraseÃ±a incorrecta');
                    setAdminPassword('');
                }
            };

            // NUEVA FUNCIÃ“N: Abrir modal para limpiar datos
            const openClearDataModal = () => {
                if (!isAdmin) {
                    alert('âŒ Solo el administrador puede realizar esta acciÃ³n');
                    return;
                }
                setShowClearDataModal(true);
                setClearDataConfirmation('');
            };

            // NUEVA FUNCIÃ“N: Limpiar todos los datos con confirmaciÃ³n
            const clearAllData = async (e) => {
                e.preventDefault();
                
                if (!isAdmin) {
                    alert('âŒ Solo el administrador puede realizar esta acciÃ³n');
                    return;
                }

                if (clearDataConfirmation !== 'CONFIRMAR') {
                    alert('âŒ Por favor escribe "CONFIRMAR" para proceder');
                    return;
                }

                try {
                    localStorage.removeItem('rifaSoldNumbers');
                    localStorage.removeItem('rifaTicketData');
                    setSoldNumbers(new Set());
                    setTicketData({});
                    setSelectedNumbers(new Set());
                    setLastSale(null);
                    setReservedNumbers(new Set());
                    setWinnerNumber(null);
                    setDrawExecuted(false);
                    setTicketCounter(1);
                    
                    await db.collection('rifa').doc('numbers').set({});
                    await db.collection('rifa').doc('tickets').set({});
                    await db.collection('rifa').doc('reserved').set({});
                    await db.collection('rifa').doc('draw').set({});
                    await db.collection('rifa').doc('metadata').set({ ticketCounter: 1 });
                    
                    setShowClearDataModal(false);
                    setClearDataConfirmation('');
                    
                    alert('âœ… Todos los datos han sido limpiados exitosamente');
                } catch (error) {
                    console.error('Error limpiando datos:', error);
                    alert('âŒ Error al limpiar los datos. IntÃ©ntalo de nuevo.');
                }
            };

            const generatePDFReport = () => {
                if (!isAdmin) {
                    alert('âŒ Solo el administrador puede generar reportes');
                    return;
                }

                const doc = new jsPDF();
                
                doc.setFontSize(20);
                doc.text('REPORTE DE RIFA - $1.000.000', 105, 15, { align: 'center' });
                
                doc.setFontSize(10);
                doc.text(`Fecha de generaciÃ³n: ${new Date().toLocaleString('es-CO')}`, 105, 22, { align: 'center' });
                doc.text('Sorteo: Chance Pick 3 Noche - 31 de Octubre', 105, 28, { align: 'center' });
                
                const tableData = [];
                
                const uniqueTickets = {};
                Object.entries(ticketData).forEach(([numero, data]) => {
                    if (data.ticketNumber && !uniqueTickets[data.ticketNumber]) {
                        uniqueTickets[data.ticketNumber] = {
                            ...data,
                            numeros: [parseInt(numero)]
                        };
                    } else if (data.ticketNumber && uniqueTickets[data.ticketNumber]) {
                        uniqueTickets[data.ticketNumber].numeros.push(parseInt(numero));
                    }
                });

                Object.values(uniqueTickets).sort((a, b) => a.ticketNumber.localeCompare(b.ticketNumber)).forEach(ticket => {
                    const numerosTexto = ticket.numeros.map(num => num.toString().padStart(3, '0')).join(', ');
                    tableData.push([
                        ticket.ticketNumber,
                        `${ticket.nombre} ${ticket.apellido || ''}`.trim(),
                        numerosTexto,
                        ticket.telefono,
                        ticket.email || '',
                        ticket.estado === 'pagado' ? 'PAGADO' : 'RESERVADO',
                        ticket.metodoPago
                    ]);
                });
                
                doc.autoTable({
                    startY: 35,
                    head: [['Ticket', 'Cliente', 'NÃºmeros', 'TelÃ©fono', 'Email', 'Estado', 'MÃ©todo Pago']],
                    body: tableData,
                    theme: 'grid',
                    headStyles: { 
                        fillColor: [79, 70, 229],
                        textColor: 255,
                        fontStyle: 'bold'
                    },
                    styles: {
                        fontSize: 8,
                        cellPadding: 2
                    },
                    columnStyles: {
                        0: { cellWidth: 20 },
                        1: { cellWidth: 30 },
                        2: { cellWidth: 25 },
                        3: { cellWidth: 25 },
                        4: { cellWidth: 30 },
                        5: { cellWidth: 15 },
                        6: { cellWidth: 20 }
                    }
                });
                
                const finalY = doc.lastAutoTable.finalY + 10;
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text(`**Total vendidos: ${soldNumbers.size}**`, 14, finalY);
                doc.text(`**Total reservados: ${reservedNumbers.size}**`, 14, finalY + 6);
                doc.text(`**Disponibles: ${100 - soldNumbers.size - reservedNumbers.size}**`, 14, finalY + 12);
                
                doc.save(`reporte_rifa_${new Date().toISOString().split('T')[0]}.pdf`);
            };

            const openDrawPanel = () => {
                if (!isAdmin) {
                    alert('âŒ Solo el administrador puede realizar el sorteo');
                    return;
                }
                setShowDrawPanel(true);
            };

            const executeDraw = async () => {
                if (!isAdmin) {
                    alert('âŒ Solo el administrador puede realizar el sorteo');
                    return;
                }

                if (soldNumbers.size === 0) {
                    alert('âŒ No hay nÃºmeros vendidos para realizar el sorteo');
                    return;
                }

                if (confirm('Â¿EstÃ¡s seguro de realizar el sorteo? Â¡Esta acciÃ³n no se puede deshacer!')) {
                    let counter = 0;
                    const interval = setInterval(() => {
                        const randomNum = Math.floor(Math.random() * 100);
                        setWinnerNumber(randomNum);
                        counter++;
                        
                        if (counter > 20) {
                            clearInterval(interval);
                            const soldArray = Array.from(soldNumbers);
                            const winner = soldArray[Math.floor(Math.random() * soldArray.length)];
                            setWinnerNumber(winner);
                            setDrawExecuted(true);
                            
                            db.collection('rifa').doc('draw').set({ winner });
                            
                            alert(`ðŸŽ‰ Â¡SORTEO REALIZADO! El nÃºmero ganador es: ${winner.toString().padStart(3, '0')}`);
                        }
                    }, 100);
                }
            };

            const logoutAdmin = () => {
                setIsAdmin(false);
                localStorage.setItem('rifaAdmin', 'false');
                alert('ðŸ”’ SesiÃ³n de administrador cerrada');
            };

            const numbers = Array.from({ length: 100 }, (_, i) => i);

            return (
                <div className="p-3 sm:p-4">
                    {/* INDICADOR DE ESTADO */}
                    <div className="max-w-6xl mx-auto mb-4">
                        <div className={`${
                            syncStatus.includes('CONECTADO') ? 'bg-green-500/20 border-green-400' : 
                            'bg-yellow-500/20 border-yellow-400'
                        } backdrop-blur-lg rounded-xl p-3 border text-center`}>
                            <p className="text-white font-bold text-sm">{syncStatus}</p>
                        </div>
                    </div>

                    {/* NOTIFICACIÃ“N DE ÃšLTIMA VENTA */}
                    {lastSale && (
                        <div className="max-w-6xl mx-auto mb-4">
                            <div className="bg-green-500/20 backdrop-blur-lg rounded-xl p-3 border border-green-400/30 animate-pulse">
                                <p className="text-white font-bold text-center text-sm sm:text-base">
                                    {lastSale.tipo === 'actualizaciÃ³n' ? 'ðŸ”„ ACTUALIZACIÃ“N: ' : 'ðŸŽ‰ Â¡NUEVA VENTA! '}
                                    NÃºmero {lastSale.numero?.toString().padStart(3, '0')} - {lastSale.cliente}
                                </p>
                            </div>
                        </div>
                    )}

                    {/* Header */}
                    <div className="max-w-6xl mx-auto mb-6 sm:mb-8">
                        <div className="bg-white/10 backdrop-blur-lg rounded-2xl sm:rounded-3xl p-4 sm:p-6 border border-white/20 shadow-2xl">
                            <div className="text-center">
                                <h1 className="text-2xl sm:text-4xl font-bold text-white mb-2">ðŸŽ° Gran Rifa ðŸŽ°</h1>
                                <div className="bg-gradient-to-r from-yellow-400 to-yellow-600 text-black font-bold text-xl sm:text-3xl py-2 sm:py-3 px-4 sm:px-6 rounded-xl sm:rounded-2xl inline-block mb-3">
                                    $1.000.000
                                </div>
                                <p className="text-white/90 text-sm sm:text-base mb-4">Sorteo: Chance Pick 3 Noche - 31 de Octubre</p>
                                <div className="grid grid-cols-2 gap-3 sm:gap-4 max-w-md mx-auto">
                                    <div className="bg-green-500/20 backdrop-blur-sm rounded-xl p-3 border border-green-400/30">
                                        <p className="text-white font-bold text-lg sm:text-xl">{soldNumbers.size}</p>
                                        <p className="text-white/80 text-xs sm:text-sm">Vendidos</p>
                                    </div>
                                    <div className="bg-blue-500/20 backdrop-blur-sm rounded-xl p-3 border border-blue-400/30">
                                        <p className="text-white font-bold text-lg sm:text-xl">{reservedNumbers.size}</p>
                                        <p className="text-white/80 text-xs sm:text-sm">Reservados</p>
                                    </div>
                                    <div className="bg-purple-500/20 backdrop-blur-sm rounded-xl p-3 border border-purple-400/30">
                                        <p className="text-white font-bold text-lg sm:text-xl">{100 - soldNumbers.size - reservedNumbers.size}</p>
                                        <p className="text-white/80 text-xs sm:text-sm">Disponibles</p>
                                    </div>
                                    <div className="bg-orange-500/20 backdrop-blur-sm rounded-xl p-3 border border-orange-400/30">
                                        <p className="text-white font-bold text-lg sm:text-xl">${(soldNumbers.size * 25000).toLocaleString()}</p>
                                        <p className="text-white/80 text-xs sm:text-sm">Recaudado</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* NÃºmeros */}
                    <div className="max-w-6xl mx-auto mb-6">
                        <div className="bg-white/10 backdrop-blur-lg rounded-2xl sm:rounded-3xl p-4 sm:p-6 border border-white/20 shadow-2xl">
                            <div className="flex justify-between items-center mb-4">
                                <h2 className="text-xl sm:text-2xl font-bold text-white">Selecciona tus nÃºmeros</h2>
                                <div className="text-white/80 text-sm sm:text-base">
                                    Seleccionados: <span className="font-bold">{selectedNumbers.size}/5</span>
                                </div>
                            </div>
                            
                            <div className="grid responsive-grid gap-2 sm:gap-3 mb-4">
                                {numbers.map(num => {
                                    const isSold = soldNumbers.has(num);
                                    const isReserved = reservedNumbers.has(num);
                                    const isSelected = selectedNumbers.has(num);
                                    const isPending = pendingNumbers.has(num);
                                    
                                    let bgColor = 'bg-white/10 hover:bg-white/20';
                                    let textColor = 'text-white';
                                    let borderColor = 'border-white/20';
                                    
                                    if (isSold) {
                                        bgColor = 'bg-green-500/50';
                                        textColor = 'text-white';
                                        borderColor = 'border-green-400';
                                    } else if (isReserved) {
                                        bgColor = 'bg-yellow-500/50';
                                        textColor = 'text-white';
                                        borderColor = 'border-yellow-400';
                                    } else if (isSelected) {
                                        bgColor = 'bg-blue-500';
                                        textColor = 'text-white';
                                        borderColor = 'border-blue-400';
                                    } else if (isPending) {
                                        bgColor = 'bg-orange-500/50';
                                        textColor = 'text-white';
                                        borderColor = 'border-orange-400';
                                    }
                                    
                                    return (
                                        <button
                                            key={num}
                                            className={`responsive-button rounded-lg border-2 font-bold transition-all duration-200 ${bgColor} ${textColor} ${borderColor} ${
                                                !isSold && !isReserved ? 'hover:scale-105' : ''
                                            }`}
                                            onClick={() => toggleNumber(num)}
                                            disabled={isSold || isReserved}
                                        >
                                            {num.toString().padStart(3, '0')}
                                        </button>
                                    );
                                })}
                            </div>
                            
                            <div className="flex flex-col sm:flex-row gap-3 justify-center">
                                <button 
                                    onClick={openForm}
                                    disabled={selectedNumbers.size === 0}
                                    className="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-3 sm:py-4 px-6 sm:px-8 rounded-xl transition-all duration-200 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed text-base sm:text-lg"
                                >
                                    ðŸŽ« Comprar NÃºmeros
                                </button>
                                <button 
                                    onClick={showClientTicket}
                                    disabled={!currentTicket}
                                    className="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-3 sm:py-4 px-6 sm:px-8 rounded-xl transition-all duration-200 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed text-base sm:text-lg"
                                >
                                    ðŸ“‹ Ver Mi Ticket
                                </button>
                                <button 
                                    onClick={openAdminPanel}
                                    className="bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-bold py-3 sm:py-4 px-6 sm:px-8 rounded-xl transition-all duration-200 hover:scale-105 text-base sm:text-lg"
                                >
                                    ðŸ”§ Administrar
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Leyenda */}
                    <div className="max-w-6xl mx-auto mb-6">
                        <div className="bg-white/10 backdrop-blur-lg rounded-2xl sm:rounded-3xl p-4 sm:p-6 border border-white/20 shadow-2xl">
                            <div className="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4 text-center">
                                <div className="flex items-center justify-center gap-2">
                                    <div className="w-4 h-4 bg-green-500 rounded"></div>
                                    <span className="text-white text-sm sm:text-base">Vendido</span>
                                </div>
                                <div className="flex items-center justify-center gap-2">
                                    <div className="w-4 h-4 bg-yellow-500 rounded"></div>
                                    <span className="text-white text-sm sm:text-base">Reservado</span>
                                </div>
                                <div className="flex items-center justify-center gap-2">
                                    <div className="w-4 h-4 bg-blue-500 rounded"></div>
                                    <span className="text-white text-sm sm:text-base">Seleccionado</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Modal de Formulario */}
                    {showForm && (
                        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                            <div className="bg-gradient-to-br from-purple-900 to-indigo-900 rounded-2xl sm:rounded-3xl p-4 sm:p-6 border border-white/20 shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto">
                                <h3 className="text-xl sm:text-2xl font-bold text-white mb-4 text-center">Completar Compra</h3>
                                
                                <div className="bg-white/10 rounded-xl p-4 mb-4">
                                    <p className="text-white font-bold text-center mb-2">Tus NÃºmeros:</p>
                                    <div className="flex flex-wrap gap-2 justify-center">
                                        {Array.from(selectedNumbers).map(num => (
                                            <span key={num} className="bg-blue-500 text-white px-3 py-1 rounded-lg font-bold">
                                                {num.toString().padStart(3, '0')}
                                            </span>
                                        ))}
                                    </div>
                                    <p className="text-white text-center mt-2">
                                        Total: <span className="font-bold">${(selectedNumbers.size * 25000).toLocaleString()}</span>
                                    </p>
                                </div>

                                <form onSubmit={submitForm} className="space-y-4">
                                    <div>
                                        <label className="block text-white text-sm font-medium mb-1">Nombre *</label>
                                        <input
                                            type="text"
                                            name="nombre"
                                            value={formData.nombre}
                                            onChange={handleFormChange}
                                            className="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="Tu nombre"
                                            required
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-white text-sm font-medium mb-1">Apellido</label>
                                        <input
                                            type="text"
                                            name="apellido"
                                            value={formData.apellido}
                                            onChange={handleFormChange}
                                            className="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="Tu apellido"
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-white text-sm font-medium mb-1">TelÃ©fono *</label>
                                        <input
                                            type="tel"
                                            name="telefono"
                                            value={formData.telefono}
                                            onChange={handleFormChange}
                                            className="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="3112345678"
                                            required
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-white text-sm font-medium mb-1">Email</label>
                                        <input
                                            type="email"
                                            name="email"
                                            value={formData.email}
                                            onChange={handleFormChange}
                                            className="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="tu@email.com"
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-white text-sm font-medium mb-1">MÃ©todo de Pago *</label>
                                        <select
                                            name="metodoPago"
                                            value={formData.metodoPago}
                                            onChange={handleFormChange}
                                            className="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            required
                                        >
                                            <option value="nequi">ðŸ“± Nequi</option>
                                        </select>
                                    </div>

                                    <div className="form-buttons">
                                        <button
                                            type="button"
                                            onClick={abrirNequi}
                                            className="flex-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 hover:scale-105 flex items-center justify-center gap-2"
                                        >
                                            <span>ðŸ’³ Pagar con Nequi</span>
                                        </button>
                                        
                                        <button
                                            type="submit"
                                            disabled={isUploading}
                                            className="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
                                        >
                                            {isUploading ? 'â³ Procesando...' : 'âœ… Confirmar Pago'}
                                        </button>
                                    </div>

                                    <div className="text-center">
                                        <button
                                            type="button"
                                            onClick={reserveNumber}
                                            className="text-white/70 hover:text-white underline text-sm transition-colors"
                                        >
                                            ðŸ“… Solo reservar (pagar despuÃ©s)
                                        </button>
                                    </div>

                                    <div className="text-center">
                                        <button
                                            type="button"
                                            onClick={cancelForm}
                                            className="text-white/70 hover:text-white underline text-sm transition-colors"
                                        >
                                            Cancelar
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}

                    {/* Modal de Ticket */}
                    {showTicket && (
                        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                            <div className="bg-gradient-to-br from-purple-900 to-indigo-900 rounded-2xl sm:rounded-3xl p-4 sm:p-6 border border-white/20 shadow-2xl max-w-md w-full">
                                <h3 className="text-xl sm:text-2xl font-bold text-white mb-4 text-center">ðŸŽŸï¸ Tu Ticket</h3>
                                
                                {currentTicket !== null && ticketData[currentTicket] && (
                                    <div className="bg-white/10 rounded-xl p-4 sm:p-6 mb-4">
                                        <div className="text-center mb-4">
                                            <div className="bg-gradient-to-r from-yellow-400 to-yellow-600 text-black font-bold text-lg sm:text-xl py-2 px-4 rounded-lg inline-block mb-2">
                                                ${(ticketData[currentTicket].numeros?.length || 1) * 25000}
                                            </div>
                                        </div>
                                        
                                        <div className="space-y-2 text-white">
                                            <p><span className="font-bold">Cliente:</span> {ticketData[currentTicket].nombre} {ticketData[currentTicket].apellido || ''}</p>
                                            <p><span className="font-bold">TelÃ©fono:</span> {ticketData[currentTicket].telefono}</p>
                                            <p><span className="font-bold">Email:</span> {ticketData[currentTicket].email || 'No proporcionado'}</p>
                                            <p><span className="font-bold">NÃºmeros:</span> {(ticketData[currentTicket].numeros || [currentTicket]).map(num => num.toString().padStart(3, '0')).join(', ')}</p>
                                            <p><span className="font-bold">Ticket No:</span> {ticketData[currentTicket].ticketNumber}</p>
                                            <p><span className="font-bold">Estado:</span> {ticketData[currentTicket].estado === 'pagado' ? 'âœ… PAGADO' : 'ðŸ“… RESERVADO'}</p>
                                            <p><span className="font-bold">Fecha:</span> {ticketData[currentTicket].fecha}</p>
                                        </div>
                                    </div>
                                )}
                                
                                <div className="flex flex-col sm:flex-row gap-3">
                                    <button
                                        onClick={shareClientTicket}
                                        className="flex-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 hover:scale-105"
                                    >
                                        ðŸ“¤ Compartir
                                    </button>
                                    <button
                                        onClick={() => setShowTicket(false)}
                                        className="flex-1 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 hover:scale-105"
                                    >
                                        Cerrar
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Modal de Panel de AdministraciÃ³n */}
                    {showAdminPanel && (
                        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                            <div className="bg-gradient-to-br from-purple-900 to-indigo-900 rounded-2xl sm:rounded-3xl p-4 sm:p-6 border border-white/20 shadow-2xl max-w-md w-full">
                                <h3 className="text-xl sm:text-2xl font-bold text-white mb-4 text-center">ðŸ”§ Panel de AdministraciÃ³n</h3>
                                
                                <form onSubmit={handleAdminLogin}>
                                    <div className="mb-4">
                                        <label className="block text-white text-sm font-medium mb-2">ContraseÃ±a de Administrador</label>
                                        <input
                                            type="password"
                                            value={adminPassword}
                                            onChange={(e) => setAdminPassword(e.target.value)}
                                            className="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="Ingresa la contraseÃ±a"
                                            required
                                        />
                                    </div>
                                    
                                    <div className="flex gap-3">
                                        <button
                                            type="submit"
                                            className="flex-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 hover:scale-105"
                                        >
                                            Acceder
                                        </button>
                                        <button
                                            type="button"
                                            onClick={() => setShowAdminPanel(false)}
                                            className="flex-1 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 hover:scale-105"
                                        >
                                            Cancelar
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}

                    {/* Panel de Administrador (solo visible si estÃ¡ logueado) */}
                    {isAdmin && (
                        <div className="max-w-6xl mx-auto mb-6">
                            <div className="bg-white/10 backdrop-blur-lg rounded-2xl sm:rounded-3xl p-4 sm:p-6 border border-white/20 shadow-2xl">
                                <div className="flex flex-col sm:flex-row justify-between items-center mb-4">
                                    <h2 className="text-xl sm:text-2xl font-bold text-white mb-2 sm:mb-0">Panel de Administrador</h2>
                                    <button
                                        onClick={logoutAdmin}
                                        className="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-200 hover:scale-105 text-sm"
                                    >
                                        Cerrar SesiÃ³n
                                    </button>
                                </div>
                                
                                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 mb-4">
                                    <div className="bg-green-500/20 backdrop-blur-sm rounded-xl p-3 border border-green-400/30">
                                        <p className="text-white font-bold text-lg">{soldNumbers.size}</p>
                                        <p className="text-white/80 text-sm">Vendidos</p>
                                    </div>
                                    <div className="bg-yellow-500/20 backdrop-blur-sm rounded-xl p-3 border border-yellow-400/30">
                                        <p className="text-white font-bold text-lg">{reservedNumbers.size}</p>
                                        <p className="text-white/80 text-sm">Reservados</p>
                                    </div>
                                    <div className="bg-blue-500/20 backdrop-blur-sm rounded-xl p-3 border border-blue-400/30">
                                        <p className="text-white font-bold text-lg">${(soldNumbers.size * 25000).toLocaleString()}</p>
                                        <p className="text-white/80 text-sm">Recaudado</p>
                                    </div>
                                    <div className="bg-purple-500/20 backdrop-blur-sm rounded-xl p-3 border border-purple-400/30">
                                        <p className="text-white font-bold text-lg">{ticketCounter - 1}</p>
                                        <p className="text-white/80 text-sm">Tickets</p>
                                    </div>
                                </div>
                                
                                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
                                    <button
                                        onClick={generatePDFReport}
                                        className="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 hover:scale-105 flex items-center justify-center gap-2"
                                    >
                                        ðŸ“Š Generar Reporte PDF
                                    </button>
                                    
                                    <button
                                        onClick={openDrawPanel}
                                        className="bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 hover:scale-105 flex items-center justify-center gap-2"
                                    >
                                        ðŸŽ² Realizar Sorteo
                                    </button>

                                    {/* NUEVO BOTÃ“N: Limpiar Datos */}
                                    <button
                                        onClick={openClearDataModal}
                                        className="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 hover:scale-105 flex items-center justify-center gap-2"
                                    >
                                        ðŸ—‘ï¸ Limpiar Todos los Datos
                                    </button>
                                </div>

                                {/* Lista de nÃºmeros reservados para actualizar pago */}
                                {reservedNumbers.size > 0 && (
                                    <div className="mt-6">
                                        <h3 className="text-lg font-bold text-white mb-3">ðŸ“… NÃºmeros Reservados - Actualizar a Pagado</h3>
                                        <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2">
                                            {Array.from(reservedNumbers).map(num => (
                                                <button
                                                    key={num}
                                                    onClick={() => openUpdatePaymentModal(num)}
                                                    className="bg-yellow-500/50 hover:bg-yellow-600/70 text-white font-bold py-2 px-3 rounded-lg transition-all duration-200 hover:scale-105 text-sm"
                                                >
                                                    {num.toString().padStart(3, '0')}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {/* Modal de ActualizaciÃ³n de Pago para Reservas */}
                    {showUpdatePaymentModal && (
                        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                            <div className="bg-gradient-to-br from-purple-900 to-indigo-900 rounded-2xl sm:rounded-3xl p-4 sm:p-6 border border-white/20 shadow-2xl max-w-md w-full">
                                <h3 className="text-xl sm:text-2xl font-bold text-white mb-4 text-center">ðŸ’³ Actualizar Pago de Reserva</h3>
                                
                                {selectedReservedNumber !== null && ticketData[selectedReservedNumber] && (
                                    <div className="bg-white/10 rounded-xl p-4 mb-4">
                                        <p className="text-white text-center font-bold mb-2">
                                            NÃºmero: {selectedReservedNumber.toString().padStart(3, '0')}
                                        </p>
                                        <p className="text-white text-center">
                                            Cliente: {ticketData[selectedReservedNumber].nombre} {ticketData[selectedReservedNumber].apellido || ''}
                                        </p>
                                        <p className="text-white text-center">
                                            TelÃ©fono: {ticketData[selectedReservedNumber].telefono}
                                        </p>
                                    </div>
                                )}

                                <form onSubmit={updateReservationToPaid}>
                                    <div className="mb-4">
                                        <label className="block text-white text-sm font-medium mb-2">MÃ©todo de Pago *</label>
                                        <select
                                            name="metodoPago"
                                            value={updatePaymentData.metodoPago}
                                            onChange={handleUpdatePaymentChange}
                                            className="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            required
                                        >
                                            <option value="nequi">ðŸ“± Nequi</option>
                                        </select>
                                    </div>

                                    <div className="flex gap-3">
                                        <button
                                            type="submit"
                                            disabled={isUploading}
                                            className="flex-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
                                        >
                                            {isUploading ? 'â³ Procesando...' : 'âœ… Confirmar Pago'}
                                        </button>
                                        <button
                                            type="button"
                                            onClick={() => setShowUpdatePaymentModal(false)}
                                            className="flex-1 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 hover:scale-105"
                                        >
                                            Cancelar
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}

                    {/* Modal de Limpiar Datos */}
                    {showClearDataModal && (
                        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                            <div className="bg-gradient-to-br from-purple-900 to-indigo-900 rounded-2xl sm:rounded-3xl p-4 sm:p-6 border border-white/20 shadow-2xl max-w-md w-full">
                                <h3 className="text-xl sm:text-2xl font-bold text-white mb-4 text-center">âš ï¸ Limpiar Todos los Datos</h3>
                                
                                <div className="bg-red-500/20 rounded-xl p-4 mb-4 border border-red-400/30">
                                    <p className="text-white text-center font-bold mb-2">âš ï¸ ADVERTENCIA âš ï¸</p>
                                    <p className="text-white text-sm text-center">
                                        Esta acciÃ³n eliminarÃ¡ TODOS los datos de la rifa incluyendo:
                                    </p>
                                    <ul className="text-white text-sm mt-2 space-y-1">
                                        <li>â€¢ Todos los nÃºmeros vendidos ({soldNumbers.size})</li>
                                        <li>â€¢ Todos los nÃºmeros reservados ({reservedNumbers.size})</li>
                                        <li>â€¢ Todos los tickets y datos de clientes</li>
                                        <li>â€¢ El resultado del sorteo (si existe)</li>
                                        <li>â€¢ El contador de tickets</li>
                                    </ul>
                                    <p className="text-white font-bold text-center mt-3">
                                        Â¡Esta acciÃ³n NO se puede deshacer!
                                    </p>
                                </div>

                                <form onSubmit={clearAllData}>
                                    <div className="mb-4">
                                        <label className="block text-white text-sm font-medium mb-2">
                                            Escribe "CONFIRMAR" para proceder:
                                        </label>
                                        <input
                                            type="text"
                                            value={clearDataConfirmation}
                                            onChange={(e) => setClearDataConfirmation(e.target.value)}
                                            className="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-red-500"
                                            placeholder="CONFIRMAR"
                                            required
                                        />
                                    </div>

                                    <div className="flex gap-3">
                                        <button
                                            type="submit"
                                            disabled={clearDataConfirmation !== 'CONFIRMAR'}
                                            className="flex-1 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
                                        >
                                            ðŸ—‘ï¸ Limpiar Todo
                                        </button>
                                        <button
                                            type="button"
                                            onClick={() => setShowClearDataModal(false)}
                                            className="flex-1 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 hover:scale-105"
                                        >
                                            Cancelar
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}

                    {/* Modal de Sorteo */}
                    {showDrawPanel && (
                        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                            <div className="bg-gradient-to-br from-purple-900 to-indigo-900 rounded-2xl sm:rounded-3xl p-4 sm:p-6 border border-white/20 shadow-2xl max-w-md w-full">
                                <h3 className="text-xl sm:text-2xl font-bold text-white mb-4 text-center">ðŸŽ² Realizar Sorteo</h3>
                                
                                {!drawExecuted ? (
                                    <div className="text-center">
                                        <div className="bg-white/10 rounded-xl p-6 mb-4">
                                            <p className="text-white text-lg mb-4">Â¿EstÃ¡s listo para realizar el sorteo?</p>
                                            <div className="text-4xl font-bold text-yellow-400 mb-4">
                                                {winnerNumber !== null ? winnerNumber.toString().padStart(3, '0') : '---'}
                                            </div>
                                            <p className="text-white/80 text-sm">
                                                NÃºmeros vendidos: {soldNumbers.size}
                                            </p>
                                        </div>
                                        
                                        <button
                                            onClick={executeDraw}
                                            className="w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-4 px-6 rounded-lg transition-all duration-200 hover:scale-105 text-lg"
                                        >
                                            ðŸŽ‰ REALIZAR SORTEO
                                        </button>
                                    </div>
                                ) : (
                                    <div className="text-center">
                                        <div className="bg-gradient-to-r from-yellow-400 to-yellow-600 rounded-xl p-6 mb-4">
                                            <p className="text-black font-bold text-lg mb-2">ðŸŽ‰ Â¡SORTEO REALIZADO! ðŸŽ‰</p>
                                            <div className="text-4xl font-bold text-black">
                                                {winnerNumber.toString().padStart(3, '0')}
                                            </div>
                                            <p className="text-black font-bold mt-2">Â¡NÃšMERO GANADOR!</p>
                                        </div>
                                        
                                        {ticketData[winnerNumber] && (
                                            <div className="bg-white/10 rounded-xl p-4 mb-4">
                                                <p className="text-white font-bold">GANADOR:</p>
                                                <p className="text-white">{ticketData[winnerNumber].nombre} {ticketData[winnerNumber].apellido || ''}</p>
                                                <p className="text-white">Tel: {ticketData[winnerNumber].telefono}</p>
                                            </div>
                                        )}
                                    </div>
                                )}
                                
                                <button
                                    onClick={() => setShowDrawPanel(false)}
                                    className="w-full bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 hover:scale-105 mt-3"
                                >
                                    Cerrar
                                </button>
                            </div>
                        </div>
                    )}

                    {/* Footer */}
                    <div className="max-w-6xl mx-auto">
                        <div className="bg-white/10 backdrop-blur-lg rounded-2xl sm:rounded-3xl p-4 sm:p-6 border border-white/20 shadow-2xl">
                            <div className="text-center">
                                <p className="text-white/80 text-sm sm:text-base">
                                    ðŸ† Organiza: <span className="font-bold text-white">Franklin Monsalve</span>
                                </p>
                                <p className="text-white/80 text-sm sm:text-base">
                                    ðŸ“ž Contacto: <span className="font-bold text-white">+57 3197118858</span>
                                </p>
                                <p className="text-white/60 text-xs sm:text-sm mt-2">
                                    Â© 2024 Rifa Franklin Monsalve - Todos los derechos reservados
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<TalonarioRifa />, document.getElementById('app'));
    </script>
</body>
</html>
